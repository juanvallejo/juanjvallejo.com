var status="loading";WebFontConfig={google:{families:["Aldrich::latin"]},loading:function(e,t){status="loading"},fontactive:function(e,t){status="loaded"},inactive:function(e,t){status="failed"}};var Browser={name:"Unknown",os:navigator.platform,online:navigator.onLine,id:null,checked:false};var wf=document.createElement("script");wf.src=("https:"==document.location.protocol?"https":"http")+"://ajax.googleapis.com/ajax/libs/webfont/1/webfont.js";wf.type="text/javascript";wf.async="true";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(wf,s);window.onload=function(){function r(t){var n=this;this.id=undefined;this.i=0;this.options=[];this.title=t||"Untitled menu";this.wrapper=document.getElementById("canvas-wrapper");this.container=document.createElement("div");this._addOption=function(e){this.options[this.i]=document.createElement("li");this.options[this.i].num=this.i;if(this.options[this.i].num==0){this.options[this.i].style.borderTop="0"}this.options[this.i].on=function(e,t){this.addEventListener(e,function(e){t.call(this,e)})};this.i++;if(typeof e=="function"){e.call(this.options[this.i-1])}else{this.options[this.i-1].innerHTML=e}};this.on=function(e,t){this.container.addEventListener(e,function(e){t.call(n,e)})};this.remove=function(){if(this.wrapper.removeChild(this.container)){this.container=null;e.focus()}};this.hide=function(){this.container.style.display="none"};this.show=function(e){this.container.style.display=e||"block"};this.option=function(e){return this.options[e-1]};this.input=function(e){return this.options[e-1].getElementsByTagName("input")[0]};this.addText=function(e){this._addOption(e);this.options[this.i-1].className="text";return this.options[this.i-1]};this.addOption=function(e){this._addOption(e);return this.options[this.i-1]};this.addInput=function(e){var t=document.createElement("input");t.placeholder=e;this._addOption(function(){this.appendChild(t)});this.options[this.i-1].className="text";this.options[this.i-1].input=function(){return t};this.options[this.i-1].input().on=function(e,t){this.addEventListener(e,function(e){t.call(this,e)})};return t};this.create=function(e,t){if(this.id){this.container.id=this.id}this.container.className="menu";var n=document.createElement("div");n.className="menu-header";n.innerHTML="<p>"+this.title+"</p>";var r=document.createElement("ul");for(var i=0;i<this.options.length;i++){if(this.options[i].num==this.options.length-1){this.options[i].style.borderBottom="0"}r.appendChild(this.options[i])}this.container.appendChild(n);this.container.appendChild(r);this.wrapper.appendChild(this.container);this.container.focus();r.style.marginTop=(this.container.clientHeight-r.clientHeight)/2+"px";return this};this.container.tabIndex=1}function i(){this.width=15;this.height=80;this.color="white";this.posY=parseInt(e.height/2)-this.height/2;this.posX=0;this.isMovingUp=false;this.isMovingDown=false;this.moveSpeed=2;this.upKey=null;this.downKey=null;this.draw=function(e,n,r,i){t.fillStyle=this.color;t.fillRect(this.posX,this.posY,this.width,this.height)}}function s(){this.radius=12;this.height=this.radius;this.x=0;this.y=parseInt(e.height/2)-this.height;this.incX=2;this.incY=1.7;this.color="white";this.draw=function(){t.fillStyle=this.color;t.beginPath();t.arc(this.x,this.y,this.radius,0,2*Math.PI,false);t.fill()}}function o(){this.x=35;this.y=60;this.value=0;this.color="white";this.align="left";this.draw=function(){t.textAlign="left";t.fillStyle=this.color;t.font="normal 2em 'Aldrich'";t.fillText(this.value,this.x,this.y)}}function u(){var n=this;this._init=null;this.ai=true;this.bgImageURI="url(data/i/bg.png)";this.controls={player1:{up:38,down:40},player2:{up:87,down:83}};this.difficulty=24;this.exited=false;this.goal=5;this.loaded=false;this.menu=null;this.paused=false;this.pauseMenuOpen=false;this.speed=1;this.timeout=null;this.setControls=function(e){var e=e||1;var t={"%":"Left Arrow","&":"Up Arrow","'":"Right Arrow","(":"Down Arrow"};var n=t[String.fromCharCode(a.controls["player"+e].up)]||String.fromCharCode(a.controls["player"+e].up);var i=t[String.fromCharCode(a.controls["player"+e].down)]||String.fromCharCode(a.controls["player"+e].down);var s=new r("Control Settings (Player "+e+")");s.addText("To change a control for player "+e+", enter the desired key below:");s.addInput("Move up ("+n+")").maxLength=1;s.addInput("Move down ("+i+")").maxLength=1;s.addOption("Back To Settings").on("click",function(){if(s.option(2).input().value!=""){if(s.option(2).input().data){a.controls["player"+e].up=s.option(2).input().data}else{a.controls["player"+e].up=s.option(2).input().value.toUpperCase().charCodeAt(0)}}if(s.option(3).input().value!=""){if(s.option(3).input().data){a.controls["player"+e].up=s.option(3).input().data}else{a.controls["player"+e].down=s.option(3).input().value.toUpperCase().charCodeAt(0)}}s.remove();a.settings()});s.option(2).input().on("keydown",function(e){if(e.keyCode!=9){this.value=""}if(e.keyCode==37||e.keyCode==38||e.keyCode==39||e.keyCode==40){this.value=e.keyIdentifier+" Arrow";this.data=e.keyCode}else{this.data=null}});s.option(3).input().on("keydown",function(e){if(e.keyCode!=9){this.value=""}if(e.keyCode==37||e.keyCode==38||e.keyCode==39||e.keyCode==40){this.value=e.keyIdentifier+" Arrow";this.data=e.keyCode}else{this.data=null}});s.create()};this.setScoreLimit=function(){var e=new r("Change score limit");e.addText("The current score limit is "+a.goal);e.addInput("Enter a new score limit");e.addOption("Back To Settings").on("click",function(){e.remove();if(e.option(2).input().value!=""){var t=parseInt(e.option(2).input().value);if(t<99){a.goal=t}else{a.goal=99}}a.settings()});e.create()};this.settings=function(){var t=new r("Change settings");t.addOption("Change Score Limit ("+a.goal+")").on("click",function(){t.remove();a.setScoreLimit()});t.addOption("Change Player 1 Controls").on("click",function(){t.remove();a.setControls(1)});t.addOption("Change Player 2 Controls").on("click",function(){t.remove();a.setControls(2)});t.addOption("Back To Menu").on("click",function(){t.remove();e.style.backgroundImage="";a.splash()});t.create().on("keydown",function(e){if(e.keyCode==27){t.remove();a.splash()}})};this.detectBrowser=function(){if(navigator.userAgent.indexOf("AppleWebKit")!=-1){if(navigator.userAgent.indexOf("Chrome")!=-1){Browser.name="Chrome";Browser.id=1}else{if(navigator.userAgent.indexOf("Mobile")!=-1){Browser.name="Mobile Safari";Browser.id=3}else{Browser.name="Safari";Browser.id=2}}}else{if(navigator.userAgent.indexOf("Firefox")!=-1){Browser.name="Firefox";Browser.id=4}else if(navigator.userAgent.indexOf("Opera")!=-1){Browser.name="Opera";Browser.id=5}else if(navigator.userAgent.indexOf("MSIE ")!=-1){if(navigator.userAgent.indexOf("Trident")!=-1){var e=navigator.userAgent.split(";")[1];e=parseInt(e.split(" ")[2]);Browser.name="Internet Explorer "+e;if(e>8)Browser.id=6;else Browser.id=7}else{Browser.name="Internet Explorer (Old)";Browser.id=8}}}if(Browser.id!=1&&!Browser.checked){Browser.checked=true;var t=new r("You are using "+Browser.name);if(Browser.id==7||Browser.id==8){t.addText("");t.addText("Unfortunately Canvas Pong is not supported in your browser, please consider upgrading to Google Chrome for an optimal browsing experience.").on("click",function(){window.open("http://chrome.google.com","_blank")});t.addText("")}else if(Browser.id==3){t.addText("Canvas Pong has not been optimized to work on mobile devices. The game will run but will be unplayable in your current device.").on("click",function(){t.remove()});t.addOption("Tap here to continue").on("click",function(){t.remove()})}else{t.addOption("While Canvas Pong will work in your current browser, Canvas Pong is better optimized to run on Google Chrome.").on("click",function(){t.remove()});t.addOption("Click here to continue").on("click",function(){t.remove()})}t.create()}};this.pause=function(){if(a.paused&&!a.pauseMenuOpen){a.resume()}else{clearTimeout(a.timeout);a.pauseMenuOpen=true;e.onclick=null;a.paused=true;var n=new r("Game paused");n.addOption("Resume").on("click",function(){n.remove();a.resume();a.pauseMenuOpen=false});n.addOption("Restart").on("click",function(){n.remove();a.start()});n.addOption("Quit").on("click",function(){n.remove();t.clearRect(0,0,e.width,e.height);e.style.backgroundImage="";a.exited=true;a.splash()});n.create();n.on("keydown",function(e){if(e.keyCode==27&&Browser.id!=2||e.keyCode==80||e.keyCode==82){n.remove();a.resume();a.pauseMenuOpen=false}})}};this.resume=function(){a.paused=false;a._init()};this.setDifficulty=function(){var e=new r("Choose a difficulty setting");e.addOption("Easy").data=24;e.addOption("Medium").data=26;e.addOption("Hard").data=28;e.create();e.on("keydown",function(t){if(t.keyCode==27){e.remove();a.splash()}});for(var t=0;t<e.options.length;t++){e.options[t].onclick=function(){a.difficulty=this.data;a.start();e.remove()}}};this.win=function(n){a.exited=true;if(n=="Computer"){var i="wins!"}else{var i=a.ai===true?"win!":"wins!"}var s=new r(n+" "+i);s.addOption("New Game").on("click",function(){s.remove();a.setDifficulty()});s.addOption("Settings").on("click",function(){s.remove();a.exited=true;a.settings()});s.addOption("Back To Menu").on("click",function(){s.remove();t.clearRect(0,0,e.width,e.height);e.style.backgroundImage="";a.exited=true;a.splash()});s.create()};this.splash=function(n){function r(){function n(){t.clearRect(0,0,e.width,e.height);e.style.backgroundColor="rgb(4,83,7)";t.font="normal 3.5em 'Aldrich'";t.fillStyle="white";t.fillText("Pong",e.width/2,e.height/2.2);t.font="normal 1.5em 'Aldrich',impact,sans-serif";t.fillText("one player",e.width/2,e.height/1.5);t.fillText("two player",e.width/2,e.height/1.3);e.addEventListener("click",function(n){var r=n.pageX-e.parentElement.offsetLeft-20;var i=n.pageY-e.parentElement.offsetTop-20;if(r>e.width/2-100&&r<e.width/2+100&&i<e.height/2+96&&i>e.height/2+50){t.clearRect(0,0,e.width,e.height);this.removeEventListener("click",arguments.callee);a.ai=true;a.setDifficulty()}else if(r>=e.width/2-100&&r<=e.width/2+100&&i>=e.height/2+97&&i<=e.height/2+140){this.removeEventListener("click",arguments.callee);a.ai=false;a.start()}else if(r>=e.width/2-100&&r<=e.width/2+100&&i>=e.height/2-70&&i<=e.height/2+10){this.removeEventListener("click",arguments.callee);a.settings()}})}t.textAlign="center";if(status=="loaded"){n()}else if(status=="loading"){if(!a.loaded){t.fillStyle="white";t.font="normal 2em sans-serif";t.fillText("Loading...",e.width/2,e.height/2+20);a.loaded=true}setTimeout(r,500)}else{status="loaded";t.font="normal 1em sans-serif";t.fillText("Failed to load web-fonts",e.width/2,e.height/2+50);setTimeout(r,2250)}}r();a.detectBrowser()};this.start=function(n){e.style.backgroundImage=a.bgImageURI;e.style.backgroundColor="rgb(4,83,7)";e.style.backgroundRepeat="repeat-y";e.style.backgroundPosition="center -5px";object=this;a.exited=false;a.paused=false;a.pauseMenuOpen=false;var r=true;var u=new i;var f=new i;var l=new o;var c=new o;c.x=e.width-55;c.align="right";u.upKey=a.controls.player2.up;u.downKey=a.controls.player2.down;f.upKey=a.controls.player1.up;f.downKey=a.controls.player1.down;f.posX=e.width-f.width;var h=new s;if(Browser.id==2){h.incX*=1.7;h.incY*=1.7;u.moveSpeed*=1.7;f.moveSpeed*=1.7;if(a.difficulty==28){a.difficulty=27}}else if(Browser.id==3){h.incX*=7.7;h.incY*=7.7;u.moveSpeed*=7.7;f.moveSpeed*=7.7}a._init=function(){function o(){h.x=0;h.y=e.height/2-h.height;a.paused=true;r=false;a.timeout=setTimeout(function(){r=true;a.paused=false;a._init()},1e3)}t.clearRect(0,0,e.width,e.height);l.draw();c.draw();h.draw();u.draw();f.draw();h.x+=h.incX;h.y+=h.incY;if(a.ai){var n=Math.round(51*Math.random());var i=a.difficulty;if(h.incX>0){if(u.posY+u.height/2<e.height/2){if(u.posY+u.height<e.height){if(n<i){if(u.posY+u.height/2+u.moveSpeed-e.height/2<5&&u.posY+u.height/2+u.moveSpeed-e.height/2>0&&(Browser.id==2||Browser.id==3)){u.posY=e.height/2-u.height/2}else{u.posY+=u.moveSpeed}}else{u.posY+=u.moveSpeed/2}}}else if(u.posY+u.height/2>e.height/2){if(u.posY>0){if(n<i){u.posY-=u.moveSpeed}else{u.posY-=u.moveSpeed/2}}}}else{if(u.posY+u.height/2!=h.y){if(h.y<u.posY+u.height/2){if(u.posY>0){if(n<i){u.posY-=u.moveSpeed}else{u.posY-=u.moveSpeed/2}}}else if(h.y>u.posY+u.height/2){if(u.posY+u.height<e.height){if(n<i){u.posY+=u.moveSpeed}else{u.posY+=u.moveSpeed/2}}}}}}if(h.x>e.width+h.radius){l.value+=1;o()}if(h.x<-2*h.radius){h.incX*=-1;c.value+=1;o()}if(u.isMovingUp&&u.posY>=0){u.posY-=u.moveSpeed}if(u.isMovingDown&&u.posY+u.height<=e.height){u.posY+=u.moveSpeed}if(f.isMovingUp&&f.posY>=0){f.posY-=u.moveSpeed}if(f.isMovingDown&&f.posY+f.height<=e.height){f.posY+=u.moveSpeed}if(h.x>0&&h.x<=u.width&&h.y<=u.posY+u.height&&h.y>=u.posY&&h.incX<0){h.incX*=-1}if(h.x<=u.width&&h.y>=u.posY&&h.y<=u.posY+u.height&&h.x>0&&h.y<=u.posY+u.height&&h.incX<0){h.incX*=-1}if(h.x+h.radius>=e.width-f.width&&h.y>=f.posY&&h.y+h.height<=f.posY+f.height+h.radius/2&&h.x<e.width&&h.y<=f.posY+f.height&&h.incX>0){h.incX*=-1}if(h.y>e.height-h.height||h.y<0){h.incY*=-1}if(!a.paused){if(l.value==a.goal||c.value==a.goal){var s;if(l.value>c.value){if(a.ai){s="Computer"}else{s="Player 1"}}else{if(a.ai){s="You"}else{s="Player 2"}}a.win(s)}else{clearTimeout(a.timeout);a.timeout=setTimeout(a._init,a.speed)}}else{if(r){t.fillStyle=this.color;t.font="normal 2em 'Aldrich'";t.fillText("Pause",e.width/2-50,e.height/2+20)}}};a._init();e.onkeydown=function(e){e.preventDefault();if(!a.ai){if(e.keyCode==u.upKey){u.isMovingUp=true}if(e.keyCode==u.downKey){u.isMovingDown=true}}if(e.keyCode==f.upKey){f.isMovingUp=true}if(e.keyCode==f.downKey){f.isMovingDown=true}if(e.keyCode==82||e.keyCode==27){if(!a.exited&&!a.pauseMenuOpen){a.pauseMenuOpen=true;a.pause()}}if(e.keyCode==80){if(!a.exited&&!a.pauseMenuOpen){a.pauseMenuOpen=true;a.pause()}}};window.onkeyup=function(e){if(e.keyCode==u.upKey){u.isMovingUp=false}if(e.keyCode==u.downKey){u.isMovingDown=false}if(e.keyCode==f.upKey){f.isMovingUp=false}if(e.keyCode==f.downKey){f.isMovingDown=false}};window.onblur=function(){if(!a.paused&&!a.exited){a.pause()}}}}var e=document.getElementById("canvas");e.tabIndex=1;var t=e.getContext("2d");var n;var a=new u;a.splash()}